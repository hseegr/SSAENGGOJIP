# 250307 DAY4 개인 과제 및 실습

## 명세서 과제 실습 - Rep 4. 유저-아이템 행렬 생성(parse.py)

- 유저, 아이템 행렬 생성하기

```
def generate_user_item_matrices(dataframes):
    """
    Req. 1-4-1: 유저-아이템 평점 행렬을 생성하고 저장합니다 (Sparse Format)
    Req. 1-4-2: 유저-음식점 카테고리 평점 평균 행렬을 생성하고 저장합니다 (Sparse Format)
    """
    reviews = dataframes["reviews"]
    stores = dataframes["stores"]

    # 유저-음식점 평점 행렬 (User-Item Matrix)
    user_item_matrix = reviews.pivot(index="user", columns="store", values="score").fillna(0)  # NaN을 0으로 변환
    user_item_sparse = user_item_matrix.astype(pd.SparseDtype("float", fill_value=0))  # 메모리 최적화

    # 저장
    dataframes["user_item_matrix"] = user_item_sparse

    # --------------------------------------

    # 유저-카테고리 평점 평균 행렬 (User-Category Matrix)
    # 음식점과 카테고리를 매칭
    reviews_with_category = reviews.merge(stores[["id", "category"]], left_on="store", right_on="id")

    # 카테고리를 분할하여 여러 컬럼으로 저장 ("카페|디저트" → ["카페", "디저트"])
    expanded = reviews_with_category.assign(category=reviews_with_category["category"].str.split("|")).explode("category")

    # 유저-카테고리 평점 평균 계산
    user_category_matrix = expanded.groupby(["user", "category"])["score"].mean().unstack().fillna(0)  # NaN을 0으로 변환
    user_category_sparse = user_category_matrix.astype(pd.SparseDtype("float", fill_value=0))  # 메모리 최적화

    # 저장
    dataframes["user_category_matrix"] = user_category_sparse

    print("[+] 유저-아이템 행렬 및 유저-카테고리 행렬 생성 완료")

    return dataframes
```
